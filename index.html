<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle Auth</title>
    <link rel="icon" type="image/png" href="logo1.png">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script type="module">
        // Import only what you use
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getDatabase, ref, get, child, set } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyAQAyKlFHZWFYlReJ4N7sCLsqzyCAN6Mkw",
          authDomain: "authit-10.firebaseapp.com",
          projectId: "authit-10",
          storageBucket: "authit-10.appspot.com",
          messagingSenderId: "937005151894",
          appId: "1:937005151894:web:ce49918ca68d80fe1a34b7"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // Export Firebase functions to global window for access in regular script
        window.firebaseDatabase = db;
        window.firebaseRef = ref;
        window.firebaseGet = get;
        window.firebaseChild = child;
        window.firebaseSet = set;
    </script>
    
    <style>
      /* Styling stays the same */
      * { box-sizing: border-box; margin: 0; padding: 0; }
  
      body {
        font-family: 'Segoe UI', sans-serif;
        background-color: #f2f4f8;
        color: #333;
        margin: 0;
        overflow-x: hidden;
      }
  
      header {
        position: fixed;
        top: 0;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.9);
        z-index: 1000;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        padding: 20px 0;
        transition: padding 0.3s ease;
      }
  
      nav {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 20px;
        transition: padding 0.3s ease;
      }
  
      .logo {
        display: flex;
        align-items: center;
        transition: transform 0.3s ease;
      }
  
      .logo img {
        height: 60px;
        transition: height 0.3s ease, transform 0.3s ease;
        border: none;
        background: none;
        display: block;
      }
  
      .logo.shrink img {
        height: 40px;
        transform: scale(0.8);
      }
  
      .logo h1 {
        font-size: 1.8rem;
        font-weight: bold;
        margin-left: 15px;
        color: #4CAF50;
        transition: font-size 0.3s ease;
      }
  
      .logo.shrink h1 {
        font-size: 1.2rem;
      }
  
      .nav-links a {
        margin-left: 20px;
        color: #333;
        text-decoration: none;
        font-size: 1rem;
        transition: color 0.3s;
      }
  
      .nav-links a:hover {
        color: #4CAF50;
      }
  
      .hero {
        height: 100vh;
        background: linear-gradient(135deg, #4CAF50, #81C784);
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 0 20px;
      }
  
      .hero h1 {
        font-size: 3rem;
        margin-bottom: 20px;
      }
  
      .hero span#typing-text {
        font-weight: bold;
        border-right: 2px solid white;
        padding-right: 4px;
        color: white;
      }
  
      .hero p {
        font-size: 1.2rem;
        margin-bottom: 30px;
        max-width: 800px;
      }
  
      .cta-button {
        background-color: #ffffff;
        color: #4CAF50;
        padding: 15px 30px;
        border-radius: 30px;
        font-size: 1.1rem;
        font-weight: bold;
        text-decoration: none;
        cursor: pointer;
        transition: background 0.3s;
      }
  
      .cta-button:hover {
        background-color: #45a049;
        color: white;
      }
  
      .section {
        padding: 100px 20px;
        text-align: center;
      }
  
      .section h2 {
        font-size: 2rem;
        margin-bottom: 20px;
      }
  
      .section p {
        font-size: 1.1rem;
        max-width: 800px;
        margin: 0 auto;
      }
  
      .cards {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-top: 40px;
        flex-wrap: wrap;
      }
  
      .card {
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0,0,0,0.05);
        flex: 1 1 300px;
        max-width: 300px;
        transition: transform 0.3s;
      }
  
      .card:hover {
        transform: translateY(-10px);
      }
  
      .card h3 {
        font-size: 1.5rem;
        margin-bottom: 15px;
      }
  
      .card p {
        font-size: 1rem;
        color: #555;
      }
  
      html {
        scroll-behavior: smooth;
      }
  
      footer {
        background-color: #333;
        color: white;
        text-align: center;
        padding: 20px;
      }
  
      .container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 40px;
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
      }
  
      .box {
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0,0,0,0.05);
        flex: 1 1 450px;
        min-width: 300px;
      }
  
      h1, h2 {
        font-size: 1.8rem;
        margin-bottom: 20px;
        color: #222;
      }
  
      input, button {
        padding: 12px 15px;
        margin: 10px 0;
        width: 100%;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 1rem;
      }
  
      input:focus {
        outline: none;
        border-color: #4CAF50;
      }
  
      input.error {
        border-color: red;
      }
  
      button {
        background-color: #4CAF50;
        color: white;
        border: none;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.3s;
      }
  
      button:hover {
        background-color: #45a049;
      }
  
      #qrCode {
        margin-top: 20px;
        display: flex;
        justify-content: center;
      }
  
      #result {
        font-size: 1rem;
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        border: 1px solid #ddd;
      }
  
      #reader {
        margin-top: 20px;
        width: 100% !important;
      }
  
      .error-message {
        color: red;
        font-size: 0.9rem;
        text-align: left;
        margin-top: 5px;
      }
  
      .hidden {
        display: none;
      }
  
      @media (max-width: 768px) {
        .container {
          flex-direction: column;
          padding: 20px;
        }
      }
      /* Styles for Docs Section */
      .docs-container {
        display: flex;
        justify-content: space-between;
        gap: 20px;
        padding: 40px 20px;
        margin-top: 60px;
      }
  
      .doc-box {
        background-color: #45a049;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
        flex: 1;
        min-width: 220px;
        text-align: center;
        transition: transform 0.3s ease;
      }
  
      .doc-box:hover {
        transform: translateY(-10px);
      }
  
      .doc-box h3 {
        font-size: 1.2rem;
        margin-bottom: 10px;
        color: #ffffff;
      }
  
      .doc-box p {
        font-size: 1rem;
        color: #fdfdfd;
      }
  
      @media (max-width: 768px) {
        .docs-container {
          flex-direction: column;
          gap: 20px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <nav>
        <div class="logo" id="logo">
          <img src="logo1.png" alt="AuthIt Logo">
          <h1>Oracle Auth</h1>
        </div>
        <div class="nav-links">
          <a href="#features">Features</a>
          <a href="#docs">Docs</a>
        </div>
      </nav>
    </header>
  
    <section class="hero">
      <h1>
        <span id="typing-text">S</span>
      </h1>
      <p>Empowering secure, real-time authentication with QR codes.</p>
      <a href="#docs" class="cta-button">Get Started</a>
    </section>
  
    <section id="features" class="section">
      <h2>Features</h2>
      <p>OracleAuth offers the most advanced authentication system, combining security, real-time interaction, and scalability.</p>
  
      <div class="container">
        <!-- QR Generator -->
        <div class="box">
          <h1>QR Generator</h1>
          <input type="text" id="name" placeholder="Name">
          <input type="text" id="uid" placeholder="UID (12 digits)">
          <input type="date" id="dob" placeholder="Date of Birth">
          <input type="email" id="email" placeholder="Email">
          <div id="formError" class="error-message"></div>
          <button onclick="createQRData()">Generate QR Code</button>
          <button id="resetBtn" class="hidden" onclick="resetForm()" style="background:#f44336;">Reset Form</button>
          <div id="qrCode"></div>
        </div>
    
        <!-- QR Scanner -->
        <div class="box">
          <h2>QR Scanner</h2>
          <div id="reader" style="position: relative;"></div>
          <button id="scanAgainBtn" class="hidden" onclick="restartScanner()">Scan Again</button>
          <div id="result"></div>
        </div>
      </div>
    </section>
    
    <!-- Docs Section -->
    <section id="docs" class="section">
      <h2>Documentation</h2>
      <p>Explore the following documents to get started with OracleAuth:</p>
      <div class="docs-container">
        <div class="doc-box">
          <h3>Getting Started</h3>
          <p>Learn how to set up OracleAuth and integrate it with your application.</p>
        </div>
        <div class="doc-box">
          <h3>API Reference</h3>
          <p>Explore the OracleAuth API and its available methods and endpoints.</p>
        </div>
        <div class="doc-box">
          <h3>Security Best Practices</h3>
          <p>Understand the best practices for keeping your application and data secure with OracleAuth.</p>
        </div>
        <div class="doc-box">
          <h3>Advanced Features</h3>
          <p>Delve into the advanced features of OracleAuth for building complex authentication systems.</p>
        </div>
      </div>
    </section>
    
    <script>
      // Global variables
      let html5QrCode;
      const resetBtn = document.getElementById("resetBtn");
      const scanAgainBtn = document.getElementById("scanAgainBtn");
      
      // Function to create QR code from user input
      function createQRData() {
        const name = document.getElementById("name");
        const uid = document.getElementById("uid");
        const dob = document.getElementById("dob");
        const email = document.getElementById("email");
        const formError = document.getElementById("formError");
      
        // Reset error states
        [name, uid, dob, email].forEach(input => input.classList.remove("error"));
        formError.textContent = "";
      
        // Validate form fields
        if (!name.value || !uid.value || !dob.value || !email.value) {
          formError.textContent = "All fields are required.";
          [name, uid, dob, email].forEach(input => {
            if (!input.value) input.classList.add("error");
          });
          return;
        }
      
        if (uid.value.length !== 12 || isNaN(uid.value)) {
          uid.classList.add("error");
          formError.textContent = "UID must be exactly 12 digits.";
          return;
        }
      
        // Create data object and hash it
        const identity = {
          name: name.value,
          uid: uid.value,
          dob: dob.value,
          email: email.value
        };
        const jsonString = JSON.stringify(identity);
        const hashKey = CryptoJS.SHA256(jsonString).toString();
      
        // Save to Firebase
        window.firebaseSet(window.firebaseRef(window.firebaseDatabase, "hashkeys/" + hashKey), identity);
      
        // Generate QR code with logo
        generateQRWithLogo(hashKey);
      }
      
      // Function to generate QR code with centered logo
      function generateQRWithLogo(data) {
        const qrDiv = document.getElementById("qrCode");
        qrDiv.innerHTML = ""; // Clear previous QR code if any
        
        // QR Code options
        const options = {
          errorCorrectionLevel: 'H', // High - allows for 30% of QR code to be damaged
          margin: 1,
          width: 300,
          height: 300,
          color: {
            dark: '#000000',
            light: '#FFFFFF'
          }
        };
        
        // Generate QR code on canvas
        QRCode.toCanvas(document.createElement("canvas"), data, options, function(error, canvas) {
          if (error) {
            console.error("Error generating QR code:", error);
            qrDiv.innerHTML = `<p style="color: red;">Error generating QR code: ${error}</p>`;
            return;
          }
          
          // Create a new canvas for the final QR code with logo
          const finalCanvas = document.createElement("canvas");
          finalCanvas.width = canvas.width;
          finalCanvas.height = canvas.height;
          const context = finalCanvas.getContext("2d");
          
          // Draw the original QR code
          context.drawImage(canvas, 0, 0, canvas.width, canvas.height);
          
          // Create and load the logo
          const logo = new Image();
          logo.crossOrigin = "Anonymous"; // Handle CORS if logo is from a different domain
          logo.src = 'logo1.png';
          
          // When logo is loaded, add it to the canvas
          logo.onload = function() {
            // Calculate logo size - typically 20-25% of QR code size
            const logoSize = canvas.width * 0.25;
            
            // Calculate position to center the logo
            const logoX = (canvas.width - logoSize) / 2;
            const logoY = (canvas.height - logoSize) / 2;
            
            // Create a white background for the logo to ensure it's visible
            context.fillStyle = "#FFFFFF";
            context.fillRect(logoX - 2, logoY - 2, logoSize + 4, logoSize + 4);
            
            // Draw the logo
            context.drawImage(logo, logoX, logoY, logoSize, logoSize);
            
            // Add the final canvas to the DOM
            qrDiv.appendChild(finalCanvas);
            
            // Show reset button
            resetBtn.classList.remove("hidden");
          };
          
          // Handle logo loading errors
          logo.onerror = function() {
            console.error("Error loading logo image");
            // If logo fails, still show the QR code without logo
            qrDiv.appendChild(canvas);
            resetBtn.classList.remove("hidden");
          };
        });
      }
      
      // Reset form function
      function resetForm() {
        document.getElementById("name").value = "";
        document.getElementById("uid").value = "";
        document.getElementById("dob").value = "";
        document.getElementById("email").value = "";
        document.getElementById("formError").textContent = "";
        document.getElementById("qrCode").innerHTML = "";
        ["name", "uid", "dob", "email"].forEach(id => {
          document.getElementById(id).classList.remove("error");
        });
        resetBtn.classList.add("hidden");
      }
      
      // Process scanned QR code data
      function showData(data) {
        const resultEl = document.getElementById('result');
        // Check if Firebase functions are available
        if (!window.firebaseRef || !window.firebaseDatabase || !window.firebaseGet || !window.firebaseChild) {
          resultEl.innerHTML = "<strong>Error:</strong> Firebase services not yet initialized. Please refresh the page.";
          return;
        }
        
        const dbRef = window.firebaseRef(window.firebaseDatabase);
      
        window.firebaseGet(window.firebaseChild(dbRef, "hashkeys/" + data))
          .then((snapshot) => {
            if (snapshot.exists()) {
              const parsed = snapshot.val();
              resultEl.innerHTML = ` 
                <strong>Name:</strong> ${parsed.name}<br>
                <strong>UID:</strong> ${parsed.uid}<br>
                <strong>Date of Birth:</strong> ${parsed.dob}<br>
                <strong>Email:</strong> ${parsed.email}<br>
              `;
              scanAgainBtn.classList.remove("hidden");
            } else {
              resultEl.innerHTML = "<strong>Error:</strong> No matching data found.";
              scanAgainBtn.classList.remove("hidden");
            }
          })
          .catch(error => {
            resultEl.innerHTML = `<strong>Error:</strong> ${error.message}`;
            scanAgainBtn.classList.remove("hidden");
          });
      }
      
      // QR Scanner success handler
      function onScanSuccess(decodedText, decodedResult) {
        if (html5QrCode) {
          html5QrCode.stop().then(() => {
            showData(decodedText);
          }).catch(err => {
            console.error("Error stopping scanner:", err);
          });
        } else {
          showData(decodedText);
        }
      }
      
      // Restart scanner function
      function restartScanner() {
        document.getElementById("result").textContent = "";
        scanAgainBtn.classList.add("hidden");
        startScanner();
      }
      
      // Initialize scanner function
      function startScanner() {
        try {
          html5QrCode = new Html5Qrcode("reader");
          const config = { fps: 10, qrbox: { width: 250, height: 250 } };
          
          html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess, (errorMessage) => {
            // QR Code scanning is actively scanning but nothing detected
            console.log("QR Scanning in progress...");
          })
          .catch(err => {
            console.error("Scanner error:", err);
            document.getElementById("result").innerHTML = `
              <p style="color: red;">Scanner error: ${err.message}</p>
              <p>Please make sure camera permissions are granted and you're using HTTPS if required by your browser.</p>
            `;
            scanAgainBtn.classList.remove("hidden");
          });
        } catch (err) {
          console.error("Error initializing scanner:", err);
          document.getElementById("result").innerHTML = `
            <p style="color: red;">Error initializing scanner: ${err.message}</p>
          `;
        }
      }
      
      // Make functions available globally
      window.createQRData = createQRData;
      window.resetForm = resetForm;
      window.restartScanner = restartScanner;
      
      // Start typing animation for hero section
      const words = ["Secure", "Sovereign", "Seamless"];
      let currentWordIndex = 0;
      let currentCharIndex = 0;
      let isDeleting = false;
      
      function typeWord() {
        const typingElement = document.getElementById("typing-text");
        if (!typingElement) return;
        
        const currentWord = words[currentWordIndex];
        const currentChar = currentWord.substring(0, currentCharIndex);
        typingElement.textContent = currentChar;
        
        if (isDeleting) {
          currentCharIndex--;
        } else {
          currentCharIndex++;
        }
        
        if (currentCharIndex === currentWord.length + 1) {
          isDeleting = true;
          setTimeout(typeWord, 500);
        } else if (currentCharIndex === 0) {
          isDeleting = false;
          currentWordIndex = (currentWordIndex + 1) % words.length;
          setTimeout(typeWord, 500);
        } else {
          setTimeout(typeWord, isDeleting ? 100 : 200);
        }
      }
      
      // Initialize everything when DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Start typing animation
        typeWord();
        
        // Initialize scanner
        setTimeout(() => {
          startScanner();
        }, 1000); // Give a small delay for everything to load properly
      });
    </script>
  </body>
</html>